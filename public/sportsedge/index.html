<!doctype html>
<html lang='en'>
<head>
<meta charset='utf-8'/>
<meta name='viewport' content='width=device-width,initial-scale=1'/>
<title>SportsEdge NFL Picks • UI v20</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#0f1724; --panel-2:#111c2e; --line:#1b2a43; --muted:#9fb0c6; --txt:#eaf0f8;
    --green:#41e2a6; --yellow:#ffd166; --red:#ff6b6b; --blue:#4da3ff;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 600px at 20% -10%, #0f1930 0%, #0b0f14 60%);color:var(--txt);font:15px/1.5 system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:1200px;margin:28px auto;padding:0 20px}
  header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
  .logo{width:28px;height:28px;border-radius:9px;background:conic-gradient(from 40deg, #41e2a6, #4da3ff);box-shadow:0 0 0 3px #0f1724}
  h1{font-size:28px;margin:0;font-weight:700}
  .sub{color:var(--muted);font-size:13px}
  .version{color:#7cffb2;margin-left:8px;font-weight:700}
  .row{display:grid;grid-template-columns:1.1fr .9fr;gap:18px;margin-top:16px}
  @media (max-width:980px){.row{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);border:1px solid var(--line);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .card h2{font-size:18px;margin:0 0 10px;padding:16px 16px 0}
  .card .body{padding:16px}
  .muted{color:var(--muted)}
  .toolbar{display:flex;flex-wrap:wrap;gap:10px;margin:0 0 12px}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#0c1423}
  select,.btn{appearance:none;background:#0c1423;border:1px solid var(--line);color:var(--txt);padding:8px 10px;border-radius:10px}
  .btn{cursor:pointer}
  .list{display:flex;flex-direction:column;gap:10px}
  .item{display:grid;grid-template-columns:140px 1fr 190px 110px;gap:10px;align-items:center;padding:12px;border:1px solid var(--line);border-radius:12px;background:rgba(17,28,46,.6)}
  @media (max-width:840px){.item{grid-template-columns:1fr}}
  .teams{font-weight:600}
  .market{font-size:12px;color:var(--muted)}
  .rec{font-weight:700}
  .edgebar{height:8px;border-radius:6px;background:#0b1322;overflow:hidden;border:1px solid var(--line)}
  .edgebar > i{display:block;height:100%}
  .g{color:var(--green)} .y{color:var(--yellow)} .r{color:var(--red)}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 8px;border-radius:10px;border:1px solid var(--line);background:#0c1423}
  .grid2{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  @media (max-width:700px){.grid2{grid-template-columns:1fr}}
  footer{color:var(--muted);font-size:12px;margin:26px 2px}
  .empty{padding:12px;border:1px dashed var(--line);border-radius:10px;background:#0c1423;color:var(--muted)}
  .arch{display:flex;flex-direction:column;gap:10px}
  .arch .rowx{display:flex;justify-content:space-between;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#0c1423}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo"></div>
      <div>
        <h1>SportsEdge Weekly NFL Picks <span class="version">UI v20</span></h1>
        <div class="sub">Colors: <b class="g">● Green</b> • <b class="y">● Yellow</b> • <b class="r">● Red</b></div>
      </div>
    </header>

    <div class="row">
      <!-- Left: This Week -->
      <section class="card">
        <h2>This Week</h2>
        <div class="body">
          <div class="toolbar">
            <div class="pill"><span class="muted">Season</span>
              <select id="season"></select>
            </div>
            <div class="pill"><span class="muted">Week</span>
              <select id="week"></select>
            </div>
            <button id="refresh" class="btn">Refresh</button>
            <div id="updated" class="pill muted">–</div>
          </div>
          <div id="weekly" class="list"></div>
          <div id="weekly-empty" class="empty" style="display:none">No picks found for the selected week.</div>
        </div>
      </section>

      <!-- Right: Season to Date -->
      <section class="card">
        <h2>Season to Date</h2>
        <div class="body">
          <div class="grid2">
            <div class="chip"><b class="g">Green</b> <span id="gCount">0</span></div>
            <div class="chip"><b class="y">Yellow</b> <span id="yCount">0</span></div>
            <div class="chip"><b class="r">Red</b> <span id="rCount">0</span></div>
            <div class="chip"><span class="muted">Summary</span> <b id="summary">–</b></div>
          </div>
        </div>
      </section>
    </div>

    <!-- Archive -->
    <section class="card" style="margin-top:18px">
      <h2>Archive (2024 → Now)</h2>
      <div class="body">
        <div id="archive" class="arch"></div>
      </div>
    </section>

    <footer>© SportsEdge — entertainment/testing only</footer>
  </div>

<script>
const byId = (id)=>document.getElementById(id);
const  = byId('week'),  = byId('season'),  = byId('weekly');
const  = byId('weekly-empty'),  = byId('updated');
const =byId('gCount'), =byId('yCount'), =byId('rCount'), =byId('summary');
const  = byId('archive');

const DATA_ROOT = './data/nfl/';
const CURRENT_URL = DATA_ROOT + 'current.json';
const HISTORY_URL = DATA_ROOT + 'history.json';

function barColor(color){ return color==='green'?'var(--green)':color==='yellow'?'var(--yellow)':'var(--red)'; }
function pctSpan(edge){ const p = Math.min(Math.abs(edge)*8, 100); return p; } // scale for bar width

function itemRow(g){
  const edgePct = pctSpan(g.edge||0);
  const color = g.color || 'yellow';
  const mkt = g.market?.toUpperCase() || '';
  const rec = g.recommendation || '';
  const kickoff = g.kickoff || '';
  const teams = ${g.away} @ ;

  const div = document.createElement('div');
  div.className = 'item';
  div.innerHTML = 
    <div>
      <div class="teams"></div>
      <div class="market muted"> • line  • model </div>
    </div>
    <div><div class="edgebar"><i style="width:%; background:"></i></div></div>
    <div class="rec "></div>
    <div class="muted"></div>
  ;
  return div;
}

async function fetchJSON(url){
  const r = await fetch(url + '?t=' + Date.now(), {cache:'no-store'});
  if(!r.ok) throw new Error('HTTP '+r.status);
  return r.json();
}

function fillSeasonWeekControls(history){
  // Build season/week options from history.weeks[]
  const seasons = [...new Set(history.weeks.map(w=>w.season))].sort();
  .innerHTML = seasons.map(y=><option value=""></option>).join('');
  const latest = history.weeks.at(-1) || {season: new Date().getFullYear(), week: 1};
  .value = latest.season;

  const weeksForSeason = history.weeks.filter(w=>w.season===.value).map(w=>w.week);
  const maxW = Math.max(...weeksForSeason, 1);
  const opts = Array.from({length:maxW}, (_,i)=>i+1);
  .innerHTML = opts.map(w=><option value="">W</option>).join('');
  .value = latest.week;
}

function fillArchive(history){
  .innerHTML = '';
  history.weeks.slice().reverse().forEach(w=>{
    const row = document.createElement('div');
    row.className = 'rowx';
    row.innerHTML = 
      <div>Season  • Week </div>
      <div class="muted">G  • Y  • R </div>
    ;
    row.addEventListener('click', ()=>{
      .value = w.season;
      // refresh weeks list to ensure it contains this week
      const weeksForSeason = history.weeks.filter(x=>x.season===w.season).map(x=>x.week);
      const maxW = Math.max(...weeksForSeason, w.week);
      .innerHTML = Array.from({length:maxW}, (_,i)=>i+1).map(v=><option value="20">W20</option>).join('');
      .value = w.week;
      renderFromHistory(history,w.season,w.week);
    });
    .appendChild(row);
  });
}

function renderWeekly(j){
  .innerHTML = '';
  const games = (j.games||[]).slice().sort((a,b)=>(b.edge||0)-(a.edge||0));
  games.forEach(g=>.appendChild(itemRow(g)));
  .style.display = games.length? 'none':'block';
  .textContent = 'Updated: ' + (j.updated || '—');
  // season record
  .textContent = j.record?.green ?? 0;
  .textContent = j.record?.yellow ?? 0;
  .textContent = j.record?.red ?? 0;
  .textContent = j.summary ?? '–';
}

function renderFromHistory(history, season, week){
  const found = history.weeks.find(w=>w.season==season && w.week==week);
  if(!found){ .innerHTML=''; .style.display='block'; return; }
  // found has only summary; try to load week file if present
  const file = DATA_ROOT + ${season}-w.json;
  fetchJSON(file).then(renderWeekly).catch(()=>{
    // fallback: render a stub from history counts
    renderWeekly({games:[], record:found.record, summary:found.summary, updated:'(archive summary)'});
  });
}

async function boot(){
  try{
    const [current, history] = await Promise.all([fetchJSON(CURRENT_URL), fetchJSON(HISTORY_URL)]);
    fillSeasonWeekControls(history);
    fillArchive(history);
    renderWeekly(current);
    .onclick = ()=>boot(); // simple reload
    .onchange = ()=>renderFromHistory(history, +.value, +.value);
    .onchange   = ()=>renderFromHistory(history, +.value, +.value);
  }catch(e){
    .innerHTML = '<div class="empty">Failed to load data: '+e.message+'</div>';
  }
}
const  = byId('refresh');
boot();
</script>
</body></html>
